import{getStyleFromHsl as e}from"tsparticles-engine";const a=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d.]+%?\))|currentcolor/gi;function replaceColorSvg(r,o,t){const{svgData:i}=r;if(!i)return"";const s=e(o,t);if(i.includes("fill"))return
i.replace(a,(()=>s));const l=i.indexOf(">");return`${i.substring(0,l)} fill="${s}"${i.substring(l)}`}async function loadImage(e){return new Promise((a=>{e.loading=true;const r=new Image;e.element=r;r.addEventListener("load",(()=>{e.loading=false;a()}));r.addEventListener("error",(()=>{e.element=void
0;e.error=true;e.loading=false;console.error(`Error tsParticles - loading image: ${e.source}`);a()}));r.src=e.source}))}async function downloadSvgImage(e){if("svg"!==e.type){await loadImage(e);return}e.loading=true;const a=await fetch(e.source);if(!a.ok){console.error("Error
tsParticles - Image not found");e.error=true}e.error||(e.svgData=await a.text());e.loading=false}function replaceImageColor(e,a,r,o){var t,i,s;const l=replaceColorSvg(e,r,null!==(i=null===(t=o.opacity)||void 0===t?void 0:t.value)&&void 0!==i?i:1),n={color:r,data:Object.assign(Object.assign({},e),{svgData:l}),loaded:false,ratio:a.width/a.height,replaceColor:null!==(s=a.replaceColor)&&void
0!==s?s:a.replace_color,source:a.src};return new Promise((a=>{const r=new Blob([l],{type:"image/svg+xml"}),o=URL||window.URL||window.webkitURL||window,t=o.createObjectURL(r),i=new Image;i.addEventListener("load",(()=>{n.loaded=true;n.element=i;a(n);o.revokeObjectURL(t)}));i.addEventListener("error",(async()=>{o.revokeObjectURL(t);const
r=Object.assign(Object.assign({},e),{error:false,loading:true});await loadImage(r);n.loaded=true;n.element=r.element;a(n)}));i.src=t}))}class ImageDrawer{constructor(){this._images=[]}addImage(e,a){const r=this.getImages(e);null===r||void 0===r?void 0:r.images.push(a)}destroy(){this._images=[]}draw(e,a,r,o){var
t;const i=a.image,s=null===i||void 0===i?void 0:i.element;if(!s)return;const l=null!==(t=null===i||void 0===i?void 0:i.ratio)&&void 0!==t?t:1,n={x:-r,y:-r};e.globalAlpha=o;e.drawImage(s,n.x,n.y,2*r,2*r/l);e.globalAlpha=1}getImages(e){const a=this._images.find((a=>a.id===e.id));if(a)return
a;this._images.push({id:e.id,images:[]});return this.getImages(e)}getSidesCount(){return 12}loadShape(e){if("image"!==e.shape&&"images"!==e.shape)return;const a=e.container,r=this.getImages(a).images,o=e.shapeData,t=r.find((e=>e.source===o.src));t||this.loadImageShape(a,o).then((()=>{this.loadShape(e)}))}particleInit(e,a){var
r;if("image"!==a.shape&&"images"!==a.shape)return;const o=this.getImages(e).images,t=a.shapeData,i=a.getFillColor(),s=null!==(r=t.replaceColor)&&void 0!==r?r:t.replace_color,l=o.find((e=>e.source===t.src));l&&(l.loading?setTimeout((()=>{this.particleInit(e,a)})):(async()=>{var
e,r;let o;o=l.svgData&&i?await replaceImageColor(l,t,i,a):{color:i,data:l,element:l.element,loaded:true,ratio:t.width/t.height,replaceColor:s,source:t.src};o.ratio||(o.ratio=1);const n=null!==(e=t.fill)&&void 0!==e?e:a.fill,c=null!==(r=t.close)&&void
0!==r?r:a.close,d={image:o,fill:n,close:c};a.image=d.image;a.fill=d.fill;a.close=d.close})())}async loadImageShape(e,a){var r;const o=a.src;if(!o)throw new Error("Error tsParticles - No image.src");try{const t={source:o,type:o.substring(o.length-3),error:false,loading:true};this.addImage(e,t);const
i=(null!==(r=a.replaceColor)&&void 0!==r?r:a.replace_color)?downloadSvgImage:loadImage;await i(t)}catch(e){throw new Error(`tsParticles error - ${a.src} not found`)}}}async function loadImageShape(e){await e.addShape(["image","images"],new ImageDrawer)}export{loadImageShape};
//# sourceMappingURL=index.js.map